---
title: "Covid91 vaccine study Final2025"
author: "Deztinee Saldana"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
M = filter(FinalData, sex =="M")
F = filter(FinalData, sex =="F")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```

# Coding details 

In order for the data to be evaluated efficiently, it was important to seperate the variables into the four categories that they belonged to. I made four variables called "M", "F", "gay", and "drug users". They were isolated in order to see whether or not they should take the Covid-19 Vaccine. This was so I could create the effectiveness intervals. They were stored in seperate variables. 

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

### Barplot

```{r}
dd2 <- M %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot shows the population of male people and the relationship between catching Covid, whether or not they took the vaccine or had a placebo. 

The first graph shows the counts of the people who got covid or if they were okay and if they took the placebo or not. The second graph shows the percentage of people who had the placebo or the covid-19 vaccine and whether if they had covid or not. They are all split up in groups by if they got covid-19 or not and if they had the placebo or the Covid-19 vaccine. 

Of the people who caught Covid-19, the people who took the placebo were plot as a big bar being approximately around 75% and the people who had the vaccine were significantly small, being approximately around 25%. Of the people who were OK, it was split 50/50 between people who took the placebo vs. the people who had the vaccine. 

The codes that were used to create this barplot start with the code block that begins with dd2. dd2 appars to be seen where the environment pane and it contains 4 variables. These variables include treatment, infected, count, and prcent(which stands for percent). The second group is named the basicC. It is visible in the environment area and it contains a list of 11 variables. This is in order to create the first plot. The basicCC is the last group of codes and it is also in the files pane. It contains 11 variables that are helpful when creating the percentage plot, which is the second plot. 

### Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data=M)
rowPerc(table1)
colPerc(table1)
```

These numerical results show the actual percentages of the males that got covid-19 after they took the placebo or the vaccine. 

The males that got covid-19 after taking the placebo was a huge value of 73.80%, compared to the percentage of people who got covid-19 after taking the vaccine (26.20%). Of the males that were okay, 50.01% of the men who took the placebo were fine, and 49.99% of the men who took the vaccine were fine. This shows that the covid-19 vaccine is effective in males if only 26.20% of the people who took the vaccine got covid-19. People who took the placebo got covid-19 a lot more. This is significant. 

### Inferential Results 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Msfish <- fisher.test(table1)
Msfish
```

The information that needs the most attention out of all these results would be the output of the Fisher's Exact test. The p-value that was produced is a really small number of 0.00000000000000022. It is practically 0. This means that these results are not likely to occur by chance. 

This means that the null hypothesis that being infected with covid-19 is independent of sex is strongly rejected. 

The odds ratio is 2.815604. This means that the people who took the placebo were almost 3 times more likely to get covid-19 than people who took the vaccine. This is very significant. It also shows that the vaccine is more than likely effective. 


```{r}
effect <- Msfish$p.value/(Msfish$p.value +1)
effectivenessM = Msfish$estimate/(Msfish$estimate +1)*100
print(effectivenessM)
```

```{r}
low=(Msfish$conf.int[1]/(Msfish$conf.int[1] +1))*100
hi=(Msfish$conf.int[2]/(Msfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

Seen in the area above is the effectiveness for the covid-19 vaccine for males. It is important to know that if the effectiveness is above 50% that means that the vaccine is effect. Based on the interval that is spotted above, we can conclude that the vaccine is effective in protecting males from getting covid-19. 

The odds ratio is approximately how effective the vaccine is. The odds ratio for the guys can be spotted as 73.8. The effectiveness confidence interval is about 68.85 to 78.32. 


## Females

### Barplot

```{r}
dd2 <- F %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot shows the population of female people and the relationship between catching Covid, whether or not they took the vaccine or had a placebo. 

The first graph shows the counts of the people who got covid or if they were okay and if they took the placebo or not. The second graph shows the percentage of people who had the placebo or the covid-19 vaccine and whether if they had covid or not. They are all split up in groups by if they got covid-19 or not and if they had the placebo or the Covid-19 vaccine. 


In this plot, it shows that around 65% of females who contracted covid had the placebo, and around 35% had the vaccine. It also shows that it is around 50/50 for the females that were okay whether they took the placebo or vaccine (the vaccine was a tiny bit more). When compared to the one in males, it appears that less people contracted covid-19 with the placebo and more people contracted covid-19 with the vaccine. However, it still keeps the same dynamic that the placebo leads to more people contracting covid-19 than the vaccine. 

The codes that were used to create this barplot start with the code block that begins with dd2. dd2 appars to be seen where the environment pane and it contains 4 variables. These variables include treatment, infected, count, and prcent(which stands for percent). The second group is named the basicC. It is visible in the environment area and it contains a list of 11 variables. This is in order to create the first plot. The basicCC is the last group of codes and it is also in the files pane. It contains 11 variables that are helpful when creating the percentage plot, which is the second plot. 


### Numerical results 

```{r}
table1 <- xtabs(~infected + treatment, data=F)
rowPerc(table1)
colPerc(table1)
```

These numerical results show the actual percentages of the females that got covid-19 after they took the placebo or the vaccine. 

In confirmation with the numbers I approximated from the barplot,the females that got covid-19 after taking the placebo was a big value of 65%, compared to the percentage of people who got covid-19 after taking the vaccine (35%). Of the females that were okay, 50% of the women who took the placebo were fine, and 50% of the women who took the vaccine were fine. This shows that the covid-19 vaccine is effective in females if only 35% of the people who took the vaccine got covid-19. People who took the placebo got covid-19 a lot more. This is significant. 


### Inferential 

```{r}
chisq.test(table1)
chisqtestGC(table1)
Fsfish <- fisher.test(table1)
Fsfish
```

The information that needs the most attention out of all these results would be the output of the Fisher's Exact test. The p-value that was produced is a pretty small number of 0.000000001. It is practically 0. This means that these results are not likely to occur by chance. 

This means that the null hypothesis that being infected with covid-19 is independent of sex is strongly rejected. 

The odds ratio is 1.9. This means that the female people who took the placebo were about 2 times more likely to get covid-19 than people who took the vaccine. This is significant. It also shows that the vaccine is more than likely effective. 


```{r}
effect <- Fsfish$p.value/(Fsfish$p.value +1)
effectivenessF = Fsfish$estimate/(Fsfish$estimate +1)*100
print(effectivenessF)
```

```{r}
low=(Fsfish$conf.int[1]/(Fsfish$conf.int[1] +1))*100
hi=(Fsfish$conf.int[2]/(Fsfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

Seen in the area above is the effectiveness for the covid-19 vaccine for females. It is important to know that if the effectiveness is above 50% that means that the vaccine is effect. Based on the interval that is spotted above, we can conclude that the vaccine is effective in protecting females from getting covid-19. While, it isn't as effective as it is for males, it is significantly effecitive as well.  

The odds ratio is approximately how effective the vaccine is. The odds ratio for the females can be spotted as 65. The effectiveness confidence interval is about 59.8 to 69.92. 

## LGBTQ

### Barplot

```{r}
dd2 <- gay %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot shows the population of gay people and the relationship between catching Covid, whether or not they took the vaccine or had a placebo. 

The first graph shows the counts of the people who got covid or if they were okay and if they took the placebo or not. The second graph shows the percentage of people who had the placebo or the covid-19 vaccine and whether if they had covid or not. They are all split up in groups by if they got covid-19 or not and if they had the placebo or the Covid-19 vaccine. 

Of the gay people who caught Covid-19, the people who took the placebo were plot as a very big bar being approximately around 80% and the people who had the vaccine were significantly small, being approximately around 20%. Of the people who were OK, it was about 48% people who took the placebo vs. 52% for the people who had the vaccine. This shows that for gay people, the people who took the placebo catched covid way more easier than the people who were vaccinated. 

The codes that were used to create this barplot start with the code block that begins with dd2. dd2 appars to be seen where the environment pane and it contains 4 variables. These variables include treatment, infected, count, and prcent(which stands for percent). The second group is named the basicC. It is visible in the environment area and it contains a list of 11 variables. This is in order to create the first plot. The basicCC is the last group of codes and it is also in the files pane. It contains 11 variables that are helpful when creating the percentage plot, which is the second plot. 

### Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data=gay)
rowPerc(table1)
colPerc(table1)
```

These numerical results show the actual percentages of the gays that got covid-19 after they took the placebo or the vaccine. 

In confirmation with the numbers I approximated from the barplot,the gays that got covid-19 after taking the placebo was a very big value of 80%, compared to the percentage of people who got covid-19 after taking the vaccine (20%). Of the gays that were okay, 48% of the gays who took the placebo were fine, and 52% of the gays who took the vaccine were fine. This shows that the covid-19 vaccine is effective in gays, if only 20% of the people who took the vaccine got covid-19 because it is a really low value. People who took the placebo got covid-19 a lot more. This is very significant.


### Inferential Results 

```{r}
chisq.test(table1)
chisqtestGC(table1)
gaysfish <- fisher.test(table1)
gaysfish
```

The information that needs the most attention out of all these results would be the output of the Fisher's Exact test. The p-value that was produced is a really small number of 0.0000007. It is practically 0. This means that these results are not likely to occur by chance. 

This means that the null hypothesis that being infected with covid-19 is independent of sex is strongly rejected. 

The odds ratio is 4.3. This means that the people who took the placebo were around 4 times more likely to get covid-19 than people who took the vaccine. This is very significant. It also shows that the vaccine is more than likely effective for gays. The odd ratio is bigger than both female and male. 


```{r}
effect <- gaysfish$p.value/(gaysfish$p.value +1)
effectivenessgays = gaysfish$estimate/(gaysfish$estimate +1)*100
print(effectivenessgays)
```

```{r}
low=(gaysfish$conf.int[1]/(gaysfish$conf.int[1] +1))*100
hi=(gaysfish$conf.int[2]/(gaysfish$conf.int[2] +1))*100
options(digits=2)
```


## Effectiveness Confidence Interval `r low`  to `r hi`

Seen in the area above is the effectiveness for the covid-19 vaccine for gays. It is important to know that if the effectiveness is above 50% that means that the vaccine is effect. Based on the interval that is spotted above, we can conclude that the vaccine is very effective in protecting gays from getting covid-19. 

The odds ratio is approximately how effective the vaccine is. The odds ratio for the gays can be spotted as 81. The effectiveness confidence interval is about 69 to 89.88.

## Druggies

### Barplot

```{r}
dd2 <-  Druguser %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot shows the population of drug users and the relationship between catching Covid, whether or not they took the vaccine or had a placebo. 

The first graph shows the counts of the people who got covid or if they were okay and if they took the placebo or not. The second graph shows the percentage of people who had the placebo or the covid-19 vaccine and whether if they had covid or not. They are all split up in groups by if they got covid-19 or not and if they had the placebo or the Covid-19 vaccine. 

Of the people who caught Covid-19, the people who took the placebo were plot as a very small bar being approximately around 11% and the people who had the vaccine were significantly larger, being approximately around 89%. Of the people who were OK, it was split like 52% who took the placebo vs. the 48% of people who had the vaccine. 

The codes that were used to create this barplot start with the code block that begins with dd2. dd2 appars to be seen where the environment pane and it contains 4 variables. These variables include treatment, infected, count, and prcent(which stands for percent). The second group is named the basicC. It is visible in the environment area and it contains a list of 11 variables. This is in order to create the first plot. The basicCC is the last group of codes and it is also in the files pane. It contains 11 variables that are helpful when creating the percentage plot, which is the second plot.


### Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data= Druguser)
rowPerc(table1)
colPerc(table1)
```

These numerical results show the actual percentages of the drug users that got covid-19 after they took the placebo or the vaccine. 

The drug users that got covid-19 after taking the placebo was a very small value of 8.3%, compared to the percentage of people who got covid-19 after taking the vaccine, which was very large (91.7%). Of the drug users that were okay, 51% of the drug users who took the placebo were fine, and 49% of the drug users who took the vaccine were fine. This shows that the covid-19 vaccine is ineffective in drug users if 91.7% of the people who took the vaccine got covid-19. People who took the placebo got covid-19 signficantly less. 


### Inferential Results

```{r}
chisq.test(table1)
chisqtestGC(table1)
drugfish <- fisher.test(table1)
drugfish
```

The information that needs the most attention out of all these results would be the output of the Fisher's Exact test for the Drug users. The p-value that was produced is a really small number of 0.000000000003. It is practically 0. This means that these results are not likely to occur by chance. 

This means that the null hypothesis is rejected in favor of the alternative. 

The odds ratio is 0.087. This means that the people who took the placebo were almost 0.087 times more likely to get covid-19 than people who took the vaccine. This is very significant. It also shows that the vaccine is more than likely not effective. 

```{r}
effect <- drugfish$p.value/(drugfish$p.value +1)
effectivenessdrug = drugfish$estimate/(drugfish$estimate +1)*100
print(effectivenessdrug)
```

```{r}
low=(drugfish$conf.int[1]/(drugfish$conf.int[1] +1))*100
hi=(drugfish$conf.int[2]/(drugfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

# Overall Results and Conclusions